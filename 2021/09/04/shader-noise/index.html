<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="shader," />










<meta name="description" content="Noise噪声">
<meta property="og:type" content="article">
<meta property="og:title" content="shader noise">
<meta property="og:url" content="http://example.com/2021/09/04/shader-noise/index.html">
<meta property="og:site_name" content="爱吃桃的猴哥呀">
<meta property="og:description" content="Noise噪声">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_category.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/perlin_noise.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/value_noise1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/simplex_noise.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/simplex_noise1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/waveletNoise.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/wavelet_noise_generation.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/worley_noise_principle.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/warp_fbm.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_application.png">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/Cloud.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_heightMap.png">
<meta property="article:published_time" content="2021-09-04T05:00:34.000Z">
<meta property="article:modified_time" content="2021-09-04T05:06:37.850Z">
<meta property="article:author" content="nashpan">
<meta property="article:tag" content="shader">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_category.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2021/09/04/shader-noise/"/>





  <title>shader noise | 爱吃桃的猴哥呀</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">爱吃桃的猴哥呀</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">stand out, fit in</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/04/shader-noise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/rocky.webp">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱吃桃的猴哥呀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">shader noise</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-09-04T13:00:34+08:00">
                2021-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Noise噪声">Noise噪声</h2>
<span id="more"></span>
<h3 id="什么是噪声">什么是噪声</h3>
<p><strong>噪声 = 随机 + 连续</strong></p>
<p>在图形学中，我们使用噪声就是为了把一些随机变量来引入到程序中。从程序角度来说，噪声很好理解，我们希望给定一个输入，程序可以给出一个输出：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">value_type <span class="title">noise</span><span class="params">(value_type p)</span> </span>&#123;   <span class="comment">//简单理解为程序语言中的random即可</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的输入和输出类型的维数可以是不同的组合，例如输入二维输出一维，输入二维输出二维等。我们今天就是想讨论一下上面函数中的实现部分是长什么样的。</p>
<h3 id="噪声的分类">噪声的分类</h3>
<p>根据wiki，由程序产生噪声的方法大致可以分为两类：</p>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_category.png" alt="noise_category"></p>
<p>Perlin噪声、Simplex噪声和Value噪声在性能上大致满足：Perlin噪声(O(2^n)) &lt; Value噪声&lt; Simplex噪声(O(n^2))，Simplex噪声性能最好,效果也最好。</p>
<h3 id="Perlin-Noise">Perlin Noise</h3>
<h4 id="实现">实现</h4>
<p>概括来说，Perlin噪声的实现需要三个步骤：</p>
<ol>
<li>
<p>定义一个晶格结构，每个晶格的顶点有一个“伪随机”的梯度向量（其实就是个向量啦）。对于二维的Perlin噪声来说，晶格结构就是一个平面网格，三维的就是一个立方体网格。</p>
</li>
<li>
<p>输入一个点（二维的话就是二维坐标，三维就是三维坐标，n维的就是n个坐标），我们找到和它相邻的那些晶格顶点（二维下有4个，三维下有8个，n维下有2的n次方个），计算该点到各个晶格顶点的距离向量，再分别与顶点上的梯度向量做点乘，得到2的n次方个点乘结果。</p>
</li>
<li>
<p>使用缓和曲线（ease curves）来计算它们的权重和。在原始的Perlin噪声实现中，缓和曲线是<br>
$$<br>
s(t)=3t^2−2t^3<br>
$$<br>
在2002年的论文6中，Perlin改进为<br>
$$<br>
s(t)=6t^5−15t^4+10t^3<br>
$$<br>
这里简单解释一下，为什么不直接使用s(t)=t，即线性插值。直接使用的线性插值的话，它的一阶导在晶格顶点处（即t = 0或t = 1）不为0，会造成明显的不连续性。<br>
$$<br>
s(t)=3t^2−2t^3<br>
$$<br>
在一阶导满足连续性，<br>
$$<br>
s(t)=6t^5−15t^4+10t^3<br>
$$<br>
在二阶导上仍然满足连续性。</p>
<p>我们可以用下面的图来表示上面的第一步和第二步：</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/perlin_noise.png" alt="perlin_noise"></p>
<h4 id="Perlin噪声的实现">Perlin噪声的实现</h4>
<p>主要代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vec2 <span class="title">hash22</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p = <span class="built_in">vec2</span>( <span class="built_in">dot</span>(p,<span class="built_in">vec2</span>(<span class="number">127.1</span>,<span class="number">311.7</span>)),</span><br><span class="line">              <span class="built_in">dot</span>(p,<span class="built_in">vec2</span>(<span class="number">269.5</span>,<span class="number">183.3</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1.0</span> + <span class="number">2.0</span> * <span class="built_in">fract</span>(<span class="built_in">sin</span>(p)*<span class="number">43758.5453123</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">perlin_noise</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec2 pi = <span class="built_in">floor</span>(p);</span><br><span class="line">    vec2 pf = p - pi;</span><br><span class="line"></span><br><span class="line">    vec2 w = pf * pf * (<span class="number">3.0</span> - <span class="number">2.0</span> * pf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mix</span>(<span class="built_in">mix</span>(<span class="built_in">dot</span>(<span class="built_in">hash22</span>(pi + <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">0.0</span>)), pf - <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">0.0</span>)), </span><br><span class="line">                   <span class="built_in">dot</span>(<span class="built_in">hash22</span>(pi + <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">0.0</span>)), pf - <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">0.0</span>)), w.x), </span><br><span class="line">               <span class="built_in">mix</span>(<span class="built_in">dot</span>(<span class="built_in">hash22</span>(pi + <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">1.0</span>)), pf - <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">1.0</span>)), </span><br><span class="line">                   <span class="built_in">dot</span>(<span class="built_in">hash22</span>(pi + <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">1.0</span>)), pf - <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">1.0</span>)), w.x),</span><br><span class="line">               w.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的实现实际是简化版的，我们在算梯度的时候直接取随机值，而没有归一化到单位圆内。</p>
<h3 id="Value-Noise">Value Noise</h3>
<p>它把原来的梯度替换成了一个简单的伪随机值，我们也<strong>不需要进行点乘操作</strong>，而直接把晶格顶点处的随机值按权重相加即可。如下图，即只需要将蓝色矩形中四个顶点的随机值按权重相加。</p>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/value_noise1.png" alt="value_noise1" style="zoom:67%;" /> 
<h4 id="实现-2">实现</h4>
<p>和Perlin噪声一样，它也是一种基于晶格的噪声，也需要三个步骤：</p>
<ol>
<li>
<p>定义一个晶格结构，每个晶格的顶点有一个“伪随机”的值（Value）。对于二维的Value噪声来说，晶格结构就是一个平面网格，三维的就是一个立方体网格。</p>
</li>
<li>
<p>输入一个点（二维的话就是二维坐标，三维就是三维坐标，n维的就是n个坐标），我们找到和它相邻的那些晶格顶点（二维下有4个，三维下有8个，n维下有2 个），得到这些顶点的伪随机值。</p>
</li>
<li>
<p>使用缓和曲线（ease curves）来计算它们的权重和。同样，缓和曲线可以是<br>
$$<br>
s(t) = 3t^2 - 2t^2,也可以是s(t)=6t^5−15t^4+10t^3（如果二阶导不连续对效果影响较大时）。<br>
$$</p>
</li>
</ol>
<p>Value噪声比Perlin噪声的实现更加简单，并且需要的乘法和加法操作也更少，它只需要得到晶格顶点的随机值再把它们按权重相加即可。</p>
<h4 id="主要代码">主要代码</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">value_noise</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec2 pi = <span class="built_in">floor</span>(p);</span><br><span class="line">    vec2 pf = p - pi;</span><br><span class="line"></span><br><span class="line">    vec2 w = pf * pf * (<span class="number">3.0</span> - <span class="number">2.0</span> * pf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mix</span>(<span class="built_in">mix</span>(<span class="built_in">hash21</span>(pi + <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">0.0</span>)), <span class="built_in">hash21</span>(pi + <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">0.0</span>)), w.x),</span><br><span class="line">               <span class="built_in">mix</span>(<span class="built_in">hash21</span>(pi + <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">1.0</span>)), <span class="built_in">hash21</span>(pi + <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">1.0</span>)), w.x),</span><br><span class="line">               w.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Simplex-Noise">Simplex Noise</h3>
<p>Simplex噪声的计算复杂度为O(n^2^)，优于Perlin噪声的O(2n)。而且在效果上，Simplex噪声也克服了经典的Perlin噪声在某些视觉问题。</p>
<h4 id="实现-3">实现</h4>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/simplex_noise.png" alt="simplex_noise" style="zoom:65%;" />
<p>和perlin实现的区别是将上面的矩形换成了一个三角形，所以现在存在一个问题：如何找到上面图形的三个顶点，解决方案如下图：</p>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/simplex_noise1.png" alt="simplex_noise1"></p>
<p>将等边三角形倾斜即可转化为矩形，找到顶点后，再做逆向操作即可。</p>
<h4 id="主要代码-2">主要代码</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">simplex_noise</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">float</span> K1 = <span class="number">0.366025404</span>; <span class="comment">// (sqrt(3)-1)/2;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">float</span> K2 = <span class="number">0.211324865</span>; <span class="comment">// (3-sqrt(3))/6;</span></span><br><span class="line"></span><br><span class="line">    vec2 i = <span class="built_in">floor</span>(p + (p.x + p.y) * K1);</span><br><span class="line"></span><br><span class="line">    vec2 a = p - (i - (i.x + i.y) * K2);</span><br><span class="line">    vec2 o = (a.x &lt; a.y) ? <span class="built_in">vec2</span>(<span class="number">0.0</span>, <span class="number">1.0</span>) : <span class="built_in">vec2</span>(<span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    vec2 b = a - o + K2;</span><br><span class="line">    vec2 c = a - <span class="number">1.0</span> + <span class="number">2.0</span> * K2;</span><br><span class="line"></span><br><span class="line">    vec3 h = <span class="built_in">max</span>(<span class="number">0.5</span> - <span class="built_in">vec3</span>(<span class="built_in">dot</span>(a, a), <span class="built_in">dot</span>(b, b), <span class="built_in">dot</span>(c, c)), <span class="number">0.0</span>);</span><br><span class="line">    vec3 n = h * h * h * h * <span class="built_in">vec3</span>(<span class="built_in">dot</span>(a, <span class="built_in">hash22</span>(i)), <span class="built_in">dot</span>(b, <span class="built_in">hash22</span>(i + o)), <span class="built_in">dot</span>(c, <span class="built_in">hash22</span>(i + <span class="number">1.0</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dot</span>(<span class="built_in">vec3</span>(<span class="number">70.0</span>, <span class="number">70.0</span>, <span class="number">70.0</span>), n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Wavelet-Noise">Wavelet Noise</h3>
<p>当使用一个3D噪声去绘制2D纹理表面时，容易出现走样和细节丢失的情形</p>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/waveletNoise.png" alt="waveletNoise" style="zoom: 67%;" /> 
<p>Wavelet Noise正是为了解决这个问题</p>
<h4 id="实现-4">实现</h4>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/wavelet_noise_generation.png" alt="wavelet_noise_generation" style="zoom:50%;" />         
<p>主要经过了4个步骤：</p>
<ol>
<li>产生一个噪声图R</li>
<li>降采样</li>
<li>上采样</li>
<li>将原图减去上采样的纹理图得到结果图</li>
</ol>
<h3 id="Worley-Noise">Worley Noise</h3>
<p>Worley噪声属于一种细胞噪声，就是噪声值是由随机的特征点向外扩散，最终看起来像是有一个个晶胞一样的效果。也叫网格噪声，<strong>是基于距离场</strong></p>
<p>这种细胞噪声可以应用于模拟皮革，水面等等。（Worley噪声是Voronoi噪声的改进版）</p>
<h4 id="实现-5">实现</h4>
<p>把空间分割成网格（cells），每个网格对应一个特征点。另外，为避免网格交界区域的偏差，我们需要计算像素点到相邻网格中的特征点的距离。这就是 <a target="_blank" rel="noopener" href="http://www.rhythmiccanvas.com/research/papers/worley.pdf">Steven Worley 的论文</a>中的主要思想。最后，每个像素点只需要计算到九个特征点的距离：他所在的网格的特征点和相邻的八个网格的特征点。</p>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/worley_noise_principle.png" alt="worley_noise_principle" style="zoom: 67%;" /> 
<h4 id="示例代码">示例代码</h4>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">vec2</span> r(<span class="type">vec2</span> n)</span><br><span class="line">&#123;</span><br><span class="line"> 	<span class="keyword">return</span> <span class="type">vec2</span>(r(n.x*<span class="number">23.62</span><span class="number">-300.0</span>+n.y*<span class="number">34.35</span>),r(n.x*<span class="number">45.13</span>+<span class="number">256.0</span>+n.y*<span class="number">38.89</span>)); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> Worley2D(<span class="type">vec2</span> n,<span class="type">float</span> s)</span><br><span class="line">&#123;</span><br><span class="line">    n /= s;</span><br><span class="line">    <span class="type">float</span> dis = <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">-1</span>;x&lt;=<span class="number">1</span>;x++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">-1</span>;y&lt;=<span class="number">1</span>;y++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">vec2</span> p = <span class="built_in">floor</span>(n)+<span class="type">vec2</span>(x,y);</span><br><span class="line">            p = r(p)+<span class="type">vec2</span>(x,y)-<span class="built_in">fract</span>(n);</span><br><span class="line">            dis = <span class="built_in">min</span>(dis, <span class="built_in">dot</span>(p, p));        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> - <span class="built_in">sqrt</span>(dis);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> WorleyFBM(<span class="type">vec2</span> uv)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> amplitude = <span class="number">0.5</span>;</span><br><span class="line">    <span class="type">float</span> gain = <span class="number">0.5</span>;</span><br><span class="line">    <span class="type">float</span> lacunarity = <span class="number">2.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> value = <span class="number">0.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="type">int</span> STEPS = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; STEPS; i++)</span><br><span class="line">    &#123;</span><br><span class="line">     	value += Worley2D(uv, <span class="number">2.0</span>) * amplitude;</span><br><span class="line">        amplitude *= gain;</span><br><span class="line">        uv *= lacunarity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FBM">FBM</h3>
<p>单独一个Perlin噪声虽然也有一定用处，但是效果往往很无趣。因此，Perlin指出可以使用不同的函数组合来得到更有意思的结果，这些函数组合通常就是指通过分形叠加（fractal sum）。</p>
<ul>
<li><strong>fbm 分形噪声</strong></li>
</ul>
<p>noise的叠加公式如下：<br>
$$<br>
noise§ + 1/2 noise(2P) + 1/4 noise(4p) + …<br>
$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fbm 叠加分形噪声</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise_sum</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    p = p * <span class="number">4.0</span>;</span><br><span class="line">    f += <span class="number">1.0000</span> * <span class="built_in">noise</span>(p); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.5000</span> * <span class="built_in">noise</span>(p); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.2500</span> * <span class="built_in">noise</span>(p); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.1250</span> * <span class="built_in">noise</span>(p); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.0625</span> * <span class="built_in">noise</span>(p); p = <span class="number">2.0</span> * p;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面叠加了5层，并把初始化采样距离设置为4，这都是可以自定义的。这种噪声可以用来模拟石头、山脉这类物体。</p>
<ul>
<li><strong>对噪声返回值进行了取绝对值操作。它使用的公式如下</strong>：</li>
</ul>
<p>$$<br>
|noise§| + 1/2|noise(2p)| + 1/4|noise(4p)|+…<br>
$$</p>
<p>它对应的代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise_sum_abs</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    p = p * <span class="number">7.0</span>;</span><br><span class="line">    f += <span class="number">1.0000</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.5000</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.2500</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.1250</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.0625</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于进行了绝对值操作，因此会在0值变化处出现不连续性，形成一些尖锐的效果。通过合适的颜色叠加，**我们可以用这种噪声来模拟火焰、云朵这些物体。**Perlin把这个公式称为turbulence（湍流？），因为它看起来挺像的。</p>
<ul>
<li><strong>在之前turbulnece公式的基础上使用了一个关于表面x分量的正选函数：</strong></li>
</ul>
<p>$$<br>
sin(x+|noise§ + 1/2|noise(2p)+ 1/4|noise(4p)|+…)<br>
$$</p>
<p>这个公式可以让表面沿着x方向形成一个条纹状的结构。Perlin使用这个公式模拟了一些大理石材质。我们的代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">noise_sum_abs_sin</span><span class="params">(vec2 p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    p = p * <span class="number">7.0</span>;</span><br><span class="line">    f += <span class="number">1.0000</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.5000</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.2500</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.1250</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f += <span class="number">0.0625</span> * <span class="built_in">abs</span>(<span class="built_in">noise</span>(p)); p = <span class="number">2.0</span> * p;</span><br><span class="line">    f = <span class="built_in">sin</span>(f + p.x/<span class="number">32.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="多层叠加，每层noise添加位移和旋转">多层叠加，每层noise添加位移和旋转</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tjw02241035621611/article/details/80048713">中级Shader教程07 熔岩Lava</a></p>
</blockquote>
<p>通过FBM构造基本形态，在FBM添加点变化：1.每一层的移动速度不一样  2.每层的旋转不一样</p>
<p>相关代码</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> fbm ( <span class="keyword">in</span> <span class="type">vec2</span> _st) &#123;</span><br><span class="line">    <span class="type">float</span> v = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">float</span> a = <span class="number">0.5</span>;</span><br><span class="line">    <span class="type">vec2</span> shift = <span class="type">vec2</span>(<span class="number">100.0</span>);</span><br><span class="line">    <span class="comment">// Rotate to reduce axial bias</span></span><br><span class="line">    <span class="type">mat2</span> rot = <span class="type">mat2</span>(<span class="built_in">cos</span>(<span class="number">0.5</span>), <span class="built_in">sin</span>(<span class="number">0.5</span>),</span><br><span class="line">                    -<span class="built_in">sin</span>(<span class="number">0.5</span>), <span class="built_in">cos</span>(<span class="number">0.50</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_OCTAVES; ++i) &#123;</span><br><span class="line">        v += a * noise(_st);</span><br><span class="line">        _st = rot * _st * <span class="number">2.0</span> + shift;    <span class="comment">//***********************************注意这里乘以了一个矩阵，并且加上了一个偏移量</span></span><br><span class="line">        a *= <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="域翘曲">域翘曲</h4>
<blockquote>
<p>[<a target="_blank" rel="noopener" href="https://www.iquilezles.org/www/articles/warp/warp.htm">domain warping - 2002</a>]</p>
</blockquote>
<p><em>f§ = fbm( p + fbm( p + fbm( p ) ) )</em></p>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/warp_fbm.png" alt="warp_fbm"></p>
<h3 id="可平埔的噪声">可平埔的噪声</h3>
<p>目前公认比较好的一种做法，就是在2n维上生成n维可平铺的噪声。</p>
<blockquote>
<p>这种方法是思想是，由于我们想要每个维度都是无缝的，也就是当该维度的值从0变成1的过程中，0和1之间比较是平滑过渡的，这让我们想起了“圆”，绕圆一周就是对该维度的采样过程，这样就可以保证无缝了。因此，对于二维噪声中的x轴，我们会在四维空间下的xz平面上的一个圆上进行采样，而二维噪声的y轴，则会在四维空间下的yw平面上的一个圆上进行采样。这个转化过程很简单，我们只需要使用三角函数sin和cos即可把二维采样坐标转化到单位圆上。同样，三维空间的也是类似的，我们会在六维空间下计算。这种方法不仅适用于Perlin噪声，像Worley噪声这种也同样是适合的。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/candycat1992/article/details/50346469">【图形学】谈谈噪声</a></p>
</blockquote>
<h3 id="Curl-Noise">Curl Noise</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cfb678fbd95">图形学中常见噪声生成算法综述</a></p>
</blockquote>
<h3 id="noise-的应用">noise 的应用</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://devmag.org.za/2009/04/25/perlin-noise/"><strong>How to Use Perlin Noise in Your Games</strong></a></p>
</blockquote>
<blockquote>
<p><strong>Perlin noise can be used to blend between two textures</strong>, as shown in following. You should use Perlin noise with very high contrast to prevent textures from looking fuzzy. The following code snippet shows how to blend two images using Perlin noise.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_application.png" alt="noise_application"></p>
<h4 id="云">云</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/70144964">使用噪音模拟云的效果</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@maksimtianblue/unity-shader-2d%E5%8A%A8%E6%80%81%E4%BA%91%E5%BD%A9-5f26d445a80a">2D动态云彩</a></p>
</blockquote>
<p>生成云的shadertoy代码如下</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="type">float</span> cloudscale = <span class="number">1.1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> speed = <span class="number">0.03</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> clouddark = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> cloudlight = <span class="number">0.3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> cloudcover = <span class="number">0.2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> cloudalpha = <span class="number">8.0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> skytint = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">vec3</span> skycolour1 = <span class="type">vec3</span>(<span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="type">vec3</span> skycolour2 = <span class="type">vec3</span>(<span class="number">0.4</span>, <span class="number">0.7</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="type">mat2</span> m = <span class="type">mat2</span>( <span class="number">1.6</span>,  <span class="number">1.2</span>, <span class="number">-1.2</span>,  <span class="number">1.6</span> );</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> hash( <span class="type">vec2</span> p ) &#123;</span><br><span class="line">	p = <span class="type">vec2</span>(<span class="built_in">dot</span>(p,<span class="type">vec2</span>(<span class="number">127.1</span>,<span class="number">311.7</span>)), <span class="built_in">dot</span>(p,<span class="type">vec2</span>(<span class="number">269.5</span>,<span class="number">183.3</span>)));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1.0</span> + <span class="number">2.0</span>*<span class="built_in">fract</span>(<span class="built_in">sin</span>(p)*<span class="number">43758.5453123</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> noise( <span class="keyword">in</span> <span class="type">vec2</span> p ) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="type">float</span> K1 = <span class="number">0.366025404</span>; <span class="comment">// (sqrt(3)-1)/2;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="type">float</span> K2 = <span class="number">0.211324865</span>; <span class="comment">// (3-sqrt(3))/6;</span></span><br><span class="line">	<span class="type">vec2</span> i = <span class="built_in">floor</span>(p + (p.x+p.y)*K1);	</span><br><span class="line">    <span class="type">vec2</span> a = p - i + (i.x+i.y)*K2;</span><br><span class="line">    <span class="type">vec2</span> o = (a.x&gt;a.y) ? <span class="type">vec2</span>(<span class="number">1.0</span>,<span class="number">0.0</span>) : <span class="type">vec2</span>(<span class="number">0.0</span>,<span class="number">1.0</span>); <span class="comment">//vec2 of = 0.5 + 0.5*vec2(sign(a.x-a.y), sign(a.y-a.x));</span></span><br><span class="line">    <span class="type">vec2</span> b = a - o + K2;</span><br><span class="line">	<span class="type">vec2</span> c = a - <span class="number">1.0</span> + <span class="number">2.0</span>*K2;</span><br><span class="line">    <span class="type">vec3</span> h = <span class="built_in">max</span>(<span class="number">0.5</span>-<span class="type">vec3</span>(<span class="built_in">dot</span>(a,a), <span class="built_in">dot</span>(b,b), <span class="built_in">dot</span>(c,c) ), <span class="number">0.0</span> );</span><br><span class="line">	<span class="type">vec3</span> n = h*h*h*h*<span class="type">vec3</span>( <span class="built_in">dot</span>(a,hash(i+<span class="number">0.0</span>)), <span class="built_in">dot</span>(b,hash(i+o)), <span class="built_in">dot</span>(c,hash(i+<span class="number">1.0</span>)));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dot</span>(n, <span class="type">vec3</span>(<span class="number">70.0</span>));	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> fbm(<span class="type">vec2</span> n) &#123;</span><br><span class="line">	<span class="type">float</span> total = <span class="number">0.0</span>, amplitude = <span class="number">0.1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">		total += noise(n) * amplitude;</span><br><span class="line">		n = m * n;</span><br><span class="line">		amplitude *= <span class="number">0.4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------------------</span></span><br><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord ) &#123;</span><br><span class="line">    <span class="type">vec2</span> p = fragCoord.xy / iResolution.xy;</span><br><span class="line">	<span class="type">vec2</span> uv = p*<span class="type">vec2</span>(iResolution.x/iResolution.y,<span class="number">1.0</span>);    </span><br><span class="line">    <span class="type">float</span> time = iTime * speed;</span><br><span class="line">    <span class="type">float</span> q = fbm(uv * cloudscale * <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ridged noise shape</span></span><br><span class="line">	<span class="type">float</span> r = <span class="number">0.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//noise shape</span></span><br><span class="line">	<span class="type">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">// uv = p*vec2(iResolution.x/iResolution.y,1.0);</span></span><br><span class="line">	uv *= cloudscale;</span><br><span class="line">    uv -= q - time;    </span><br><span class="line">    <span class="type">float</span> weight = <span class="number">0.7</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)&#123;</span><br><span class="line">		f += weight*noise( uv );    </span><br><span class="line">        uv = m*uv + time;</span><br><span class="line">		weight *= <span class="number">0.6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    f *= r + f;</span><br><span class="line">  </span><br><span class="line">    <span class="type">vec3</span> skycolour = <span class="built_in">mix</span>(skycolour2, skycolour1, p.y);</span><br><span class="line">    <span class="type">vec3</span> cloudcolour = <span class="type">vec3</span>(<span class="number">1.1</span>, <span class="number">1.1</span>, <span class="number">0.9</span>) * clouddark;</span><br><span class="line">    f = cloudcover + cloudalpha*f; </span><br><span class="line">    <span class="type">vec3</span> result = <span class="built_in">mix</span>(skycolour, <span class="built_in">clamp</span>(skytint * skycolour + cloudcolour, <span class="number">0.0</span>, <span class="number">1.0</span>), <span class="built_in">clamp</span>(f, <span class="number">0.0</span>, <span class="number">1.0</span>));</span><br><span class="line">	fragColor = <span class="type">vec4</span>( result, <span class="number">1.0</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码的效果如下图：</p>
<img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/Cloud.gif" alt="Cloud" style="zoom:50%;" />
<h4 id="山脉">山脉</h4>
<p>使用噪声作为高度图</p>
<p><img src="https://raw.githubusercontent.com/nashpan/image-hosting/main/markdown_image/noise_heightMap.png" alt="noise_heightMap"></p>
<h4 id="水面">水面</h4>
<p>使用噪声纹理作为高度图，不断修改水面的法线方向，使用和时间相关的变量对噪声纹理采样，得到水流动的效果；</p>
<h4 id="其它">其它</h4>
<p>noise的其它应用如生成细胞形态，皮革纹理，烟雾，大理石，布料，道路等，基本思想都是基于噪声贴图，使用噪声图作为基本纹理进行处理，如color mapping，height mapping, normal mapping等</p>
<h3 id="noise-的相关库">noise 的相关库</h3>
<ul>
<li><a target="_blank" rel="noopener" href="http://libnoise.sourceforge.net/index.html">libnoise</a></li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ol>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903862298476557">WebGL进阶——走进图形噪声</a></li>
</ol>
<p>2.<a target="_blank" rel="noopener" href="https://www.shadertoy.com/view/ldscWj">https://www.shadertoy.com/view/ldscWj</a></p>
<p>3.<a target="_blank" rel="noopener" href="https://blog.csdn.net/candycat1992/article/details/50346469">【图形学】谈谈噪声</a></p>
<ol start="4">
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/50418658">使用笔、和代码”生成“火焰</a></li>
</ol>
<p>5.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/leoin2012/p/7218033.html">[一篇文章搞懂柏林噪声算法]</a></p>
<p>6.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/341673601">几种常见的程序化噪声纹理</a></p>
<p>7.<a target="_blank" rel="noopener" href="https://blog.csdn.net/linjf520/article/details/100005528">Unity Shader - Noise 噪点图 - 实现简单山脉</a></p>
<p>8.<a target="_blank" rel="noopener" href="https://www.nvidia.fr/docs/IO/8343/RealTime-Procedural-Effects.pdf">Real-Time Procedural Effects</a></p>
<p>9.<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cfb678fbd95">图形学中常见噪声生成算法综述</a></p>
<p>10.<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/267016?utm_source=related_read&amp;utm_medium=article&amp;utm_term=related_read">如何使用噪声生成复杂的纹理？</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/shader/" rel="tag"># shader</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/29/Cmake%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B-1/" rel="next" title="Cmake简明教程">
                <i class="fa fa-chevron-left"></i> Cmake简明教程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/rocky.webp"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Noise%E5%99%AA%E5%A3%B0"><span class="nav-number">1.</span> <span class="nav-text">Noise噪声</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%99%AA%E5%A3%B0"><span class="nav-number">1.1.</span> <span class="nav-text">什么是噪声</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%99%AA%E5%A3%B0%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.2.</span> <span class="nav-text">噪声的分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Perlin-Noise"><span class="nav-number">1.3.</span> <span class="nav-text">Perlin Noise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.3.1.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Perlin%E5%99%AA%E5%A3%B0%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.3.2.</span> <span class="nav-text">Perlin噪声的实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Value-Noise"><span class="nav-number">1.4.</span> <span class="nav-text">Value Noise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.2.</span> <span class="nav-text">主要代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simplex-Noise"><span class="nav-number">1.5.</span> <span class="nav-text">Simplex Noise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-3"><span class="nav-number">1.5.1.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81-2"><span class="nav-number">1.5.2.</span> <span class="nav-text">主要代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wavelet-Noise"><span class="nav-number">1.6.</span> <span class="nav-text">Wavelet Noise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-4"><span class="nav-number">1.6.1.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Worley-Noise"><span class="nav-number">1.7.</span> <span class="nav-text">Worley Noise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-5"><span class="nav-number">1.7.1.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">1.7.2.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FBM"><span class="nav-number">1.8.</span> <span class="nav-text">FBM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E5%B1%82%E5%8F%A0%E5%8A%A0%EF%BC%8C%E6%AF%8F%E5%B1%82noise%E6%B7%BB%E5%8A%A0%E4%BD%8D%E7%A7%BB%E5%92%8C%E6%97%8B%E8%BD%AC"><span class="nav-number">1.8.1.</span> <span class="nav-text">多层叠加，每层noise添加位移和旋转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%9F%E7%BF%98%E6%9B%B2"><span class="nav-number">1.8.2.</span> <span class="nav-text">域翘曲</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E5%B9%B3%E5%9F%94%E7%9A%84%E5%99%AA%E5%A3%B0"><span class="nav-number">1.9.</span> <span class="nav-text">可平埔的噪声</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Curl-Noise"><span class="nav-number">1.10.</span> <span class="nav-text">Curl Noise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#noise-%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">1.11.</span> <span class="nav-text">noise 的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%91"><span class="nav-number">1.11.1.</span> <span class="nav-text">云</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%B1%E8%84%89"><span class="nav-number">1.11.2.</span> <span class="nav-text">山脉</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B0%B4%E9%9D%A2"><span class="nav-number">1.11.3.</span> <span class="nav-text">水面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E5%AE%83"><span class="nav-number">1.11.4.</span> <span class="nav-text">其它</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#noise-%E7%9A%84%E7%9B%B8%E5%85%B3%E5%BA%93"><span class="nav-number">1.12.</span> <span class="nav-text">noise 的相关库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">2.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nashpan</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
